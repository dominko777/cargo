(function(e){function o(e){return e instanceof Array?{latitude:e[0],longitude:e[1]}:e}var t,n,r,i,s={type:"shortest",transportMode:"car",options:"",trafficMode:"default",width:4,color:"#ff6347",marker:{text:"#",textColor:"#fff"},zoomTo:!0};i=function(n,i,u,a){var f,l,c,h;t=t||nokia.maps,n=o(n),i=o(i),u instanceof Array?a=e.extend({},s,a):(a=e.extend({},s,u),u=[]),c=function(n,i,s){var o,u,f,l={},c;s==="finished"?(o=n.getRoutes(),f=o[0],u=new t.map.Polyline(f&&f.shape,{pen:new t.util.Pen({lineWidth:a.width,strokeColor:a.color})}),r||(r=new t.map.Container,this.map.objects.add(r)),r.objects.add(u),e.each(f.waypoints,e.proxy(function(t,n){var r=e.extend({},a.marker);a.marker.text==="#"&&(r.text=t+1),this.marker(n.originalPosition,r)},this)),a.zoomTo&&this.map.zoomTo(r.getBoundingBox(),!1,"default"),l.time=f.summary.travelTime,l.length=f.summary.distance,l.waypoints=f.waypoints,l.legs=f.legs,typeof a.onroute=="function"&&a.onroute.call(this.element,l),c=e.Event("jhere.route",{route:l,target:this.element}),e(this.element).trigger(c)):s==="failed"&&e.error("Failed to calculate route")},f=new t.routing.Manager,f.addObserver("state",e.proxy(c,this)),l=new t.routing.WaypointParameterList,l.addCoordinate(n),e.each(u,function(e,t){l.addCoordinate(o(t))}),l.addCoordinate(i),h={transportModes:[a.transportMode],type:a.type,options:a.options,trafficMode:a.trafficMode},f.calculateRoute(l,[h])},n=function(){r&&r.objects&&r.objects.clear()},e.jHERE.extend("route",i),e.jHERE.extend("clearRoutes",n)})(jQuery);